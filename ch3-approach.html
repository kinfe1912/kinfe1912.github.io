
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Approach &#8212; Image processing on FPGA  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <link rel="shortcut icon" href="_static/FpgaServices.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Results" href="ch4-results.html" />
    <link rel="prev" title="Relevant concepts" href="ch2-relevant-concepts.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/FpgaServices.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Image processing on FPGA  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="ch1-problem.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch2-relevant-concepts.html">
   Relevant concepts
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ch4-results.html">
   Results
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/ch3-approach.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hdmi">
   HDMI
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulation">
   Simulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#block-diagram">
   Block Diagram
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Approach</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hdmi">
   HDMI
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulation">
   Simulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#block-diagram">
   Block Diagram
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="approach">
<h1>Approach<a class="headerlink" href="#approach" title="Permalink to this headline">#</a></h1>
<p>To perform the image processing on an image of a choice first the image has to be converted to a text file using the matlab script provided. After the image is converted to an appropriate text file set the number of rows and columns in the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">top</span><span class="c1">#(</span>
    <span class="n">parameter</span> <span class="n">NROWS</span> <span class="o">=</span> <span class="mi">240</span><span class="p">,</span> <span class="o">//</span> <span class="n">No</span> <span class="n">of</span> <span class="n">rows</span> <span class="p">(</span><span class="n">limited</span> <span class="n">by</span> <span class="n">the</span> <span class="n">scarce</span> <span class="n">memory</span> <span class="n">resources</span> <span class="n">of</span> <span class="n">the</span> <span class="n">selected</span> <span class="n">part</span><span class="p">)</span>
    <span class="n">parameter</span> <span class="n">NCOLS</span> <span class="o">=</span> <span class="mi">320</span><span class="p">)</span> <span class="o">//</span> <span class="n">No</span> <span class="n">of</span> <span class="n">columns</span> <span class="p">(</span><span class="n">limited</span> <span class="n">by</span> <span class="n">the</span> <span class="n">scarce</span> <span class="n">memory</span> <span class="n">resources</span> <span class="n">of</span> <span class="n">the</span> <span class="n">selected</span> <span class="n">part</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the number of rows and columns number of pixels will be known ‘localparam NPIXELS = NROWS * NCOLS; // No of pixels`.</p>
<p>It is assumed that the code will be running before starting to send the pixel (RGB) data through UART from the PC. Hence, the first byte that will be received will be the red component of pixel, after that the green component and lastly blue component. If this assumption is violated then the RGB data need to be enclosed in a packet with a de-limiter/synchronization word indicating the start of frame. Similarly, the code needs to be introduced in FPGA to de-packetize the data before passing it to the processing module.</p>
<p>Instantiate memory module to store the gray image. It is necessary becausae the preceding vga and hdmi. IP cores will expect continuous data flow at 25 MHz while the input image is coming through UART interface at 115200 baud rate. For memory sizing, 25 MHz/ 115200 = 217, i.e. the vga controller can consume a complete image data while 217 pixels of the next image has arrived. So, the memory depth should be greater than or equal to image size + 217.</p>
<p>Before sending the converted image data to the borad the borad needs to be programmed by generating a bitstrean file. However, a bitstream file is volatile. which means if power is turned off on the borad or the borad gets unplugged after programmed using the bitstream file the configuration data will be lost. To solve this issue a memory configuration file (.mcs) file need to be generated from the bit file. To generate a memory configuration file in vivado :</p>
<ul class="simple">
<li><p>go to tools &gt; memory configuration file</p></li>
<li><p>create the appropriate configuration device</p></li>
<li><p>program using the generated .mcs file</p></li>
<li><p>after the programing the configuration the borad can be programmed using the bitstream file and the issue of volatility will be solved</p></li>
</ul>
<p>After the boolean board is programmed the following matlab can be used to send the image dtata through UART interface to the boolean board.</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="nb">clc</span><span class="w"></span>
<span class="nb">clear</span><span class="w"> </span><span class="nb">all</span><span class="w"></span>
<span class="nb">close</span><span class="w"> </span><span class="nb">all</span><span class="w"></span>
<span class="c">%% declare the serial port and the baud rate </span><span class="w"></span>
<span class="n">ins</span><span class="p">=</span><span class="n">serial</span><span class="p">(</span><span class="s">&#39;/dev/tty.usbserial-8872482002AE1&#39;</span><span class="p">,</span><span class="s">&#39;BaudRate&#39;</span><span class="p">,</span><span class="mi">115200</span><span class="p">);</span><span class="w"> </span>
<span class="nb">fopen</span><span class="p">(</span><span class="n">ins</span><span class="p">);</span><span class="w"></span>
<span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fopen</span><span class="p">(</span><span class="s">&#39;/Users/dessekinfemichaelalemu/Desktop/ImageText.txt&#39;</span><span class="p">);</span><span class="w"></span>
<span class="n">txdata</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">textscan</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;%s&#39;</span><span class="p">);</span><span class="w"></span>
<span class="n">txdata</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">txdata</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="n">txdata</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">hex2dec</span><span class="p">(</span><span class="n">txdata</span><span class="p">);</span><span class="w"></span>
<span class="c">%% send the text image file in acontinous loop through UART</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">txdata</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">fwrite</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span><span class="w"> </span><span class="n">txdata</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="s">&#39;uint8&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="nb">fclose</span><span class="p">(</span><span class="n">ins</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Now the HDMI display can be connected and observe the image on a screen.</p>
<section id="hdmi">
<h2>HDMI<a class="headerlink" href="#hdmi" title="Permalink to this headline">#</a></h2>
<p>The HDMI/DVI encoder translates VGA signal according to HDMI specification 1.3a with interfaces for audio and auxilary data.
It can also work in DVI mode with audio and auxilary data disabled for monitors that are not compliant with HDMI specification.</p>
<p>Part of the codes in this IP core originates from [XAPP460: Video Connectivity Using TMDS I/O in Spartan-3A FPGAs] written by Bob Feng.</p>
<p><strong>Note</strong>:<br />
For monitor (even ones that with HDMI port) that are not fully compliant with HDMI specification, the video guardband defined in the HDMI specification can be interpreted as two extra pixel by the monitor.
As a result, you may see a two-pixel-wide light pink vertical line on the left of the monitor.
If you see this, configure the core in DVI mode (so that video guardband and preambles are both disabled) or see if there is an “AV” settings on your monitor to force it into HDMI compliant mode.</p>
</section>
<section id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://mygit.th-deg.de/kd26759/fpga_kinras/-/tree/main/vivado_project_sim_rgb2gray">vivado_project_sim_rgb2gray</a> is the project to simulate and test the uart data recieving and RGB to grayscale conversion. us the matlab file <code class="docutils literal notranslate"><span class="pre">imageToText.m</span></code> or following matlab script to convert an image of choice to a text file.</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="c">% %% Convert an image to a text file</span><span class="w"></span>
<span class="nb">clc</span><span class="w"></span>
<span class="nb">clear</span><span class="w"> </span><span class="nb">all</span><span class="w"></span>
<span class="nb">close</span><span class="w"> </span><span class="nb">all</span><span class="w"></span>

<span class="c">% %% Reading</span><span class="w"></span>
<span class="n">G</span><span class="p">=</span><span class="w"> </span><span class="nb">imread</span><span class="p">(</span><span class="s">&#39;test.ppm&#39;</span><span class="p">);</span><span class="w"></span>
<span class="c">% imshow(G);</span><span class="w"></span>

<span class="c">%% Reference output display</span><span class="w"></span>
<span class="c">%H= rgb2gray(G);</span><span class="w"></span>
<span class="c">%imshow(H);</span><span class="w"></span>


<span class="c">%Optional resize</span><span class="w"></span>
<span class="c">%G= imresize(G,[720 1280]);</span><span class="w"></span>
<span class="c">%G= imresize(G,[256 256]);</span><span class="w"></span>
<span class="n">G</span><span class="p">=</span><span class="w"> </span><span class="nb">imresize</span><span class="p">(</span><span class="n">G</span><span class="p">,[</span><span class="mi">25</span><span class="w"> </span><span class="mi">25</span><span class="p">]);</span><span class="w"></span>
<span class="c">%img=G;</span><span class="w"></span>
<span class="c">% imshow(G);</span><span class="w"></span>

<span class="n">H</span><span class="p">=</span><span class="w"> </span><span class="nb">rgb2gray</span><span class="p">(</span><span class="n">G</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="nb">imshow</span><span class="p">(</span><span class="n">H</span><span class="p">);</span><span class="w"></span>
<span class="n">G</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">permute</span><span class="p">(</span><span class="n">G</span><span class="p">,[</span><span class="mi">3</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="p">[</span><span class="n">R</span><span class="p">,</span><span class="n">C</span><span class="p">]=</span><span class="nb">size</span><span class="p">(</span><span class="n">G</span><span class="p">);</span><span class="w"></span>
<span class="n">G</span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">R</span><span class="o">*</span><span class="n">C</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="n">G</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">dec2hex</span><span class="p">(</span><span class="n">G</span><span class="p">);</span><span class="w"></span>
<span class="c">%% Open a file for writing</span><span class="w"></span>
<span class="n">fid</span><span class="p">=</span><span class="w"> </span><span class="nb">fopen</span><span class="p">(</span><span class="s">&#39;ImageText.txt&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">);</span><span class="w"></span>


<span class="c">%% Print in Image Values</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">G</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span>
<span class="nb">fprintf</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="s">&#39;%s\n&#39;</span><span class="p">,</span><span class="n">G</span><span class="p">(</span><span class="nb">i</span><span class="p">,:));</span><span class="w"></span>
<span class="k">end</span><span class="w"> </span>

<span class="c">%% Close the file:</span><span class="w"></span>
<span class="nb">fclose</span><span class="p">(</span><span class="n">fid</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The text file is used as test input in vivado simulation.  However if a different way of conversion is used, it is necessary to change the file name in the code <code class="docutils literal notranslate"><span class="pre">fdin</span> <span class="pre">=</span> <span class="pre">$fopen</span> <span class="pre">(&quot;ImageText.txt&quot;,&quot;r&quot;);</span></code></p>
<p>It is to be noted since UART uses very low rates compared to simulation time steps, for large resolutions simulation takes longer time.Hence to verify the working of the implemetation, small resolution images maybe considered.</p>
<p>VGA and HDMI cores can not be verified through display using simulation. The only way to check them is to verify the timings and data values in the simulation waveform.</p>
</section>
<section id="block-diagram">
<h2>Block Diagram<a class="headerlink" href="#block-diagram" title="Permalink to this headline">#</a></h2>
<p><img alt="Screenshot 2022-07-19 at 10 49 57" src="https://user-images.githubusercontent.com/88380951/179709403-6779f0bd-93a6-4044-afe4-c319e3785ed0.png" /></p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="ch2-relevant-concepts.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Relevant concepts</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="ch4-results.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Results</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Kinfemichael Desse<br/>
  
      &copy; Copyright GNU Affero General Public License v3.0.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>